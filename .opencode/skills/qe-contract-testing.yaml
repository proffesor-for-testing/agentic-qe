name: qe-contract-testing
description: "Consumer-driven contract testing with Pact, breaking change detection, API versioning, and backward compatibility validation."
minModelTier: tier3-best
tags: ["contract", "pact", "consumer-driven", "api", "microservices", "qe", "quality-engineering"]
steps:
  - name: define-consumer-contracts
    description: "Define consumer expectations as contract definitions."
    tools: ["read", "grep", "glob", "edit"]
    prompt: |
      Define consumer contracts:
      - Identify all consumers of the API
      - For each consumer, define expected request/response pairs
      - Use Pact-style matchers (like() for pattern matching, not exact values)
      - Include provider states needed for test setup
      Generate contract definition files.

  - name: verify-provider
    description: "Verify the provider fulfills all consumer contracts."
    tools: ["bash", "mcp:agentic-qe:contract_validate"]
    prompt: |
      Verify provider against all consumer contracts:
      - Set up provider state handlers for each test scenario
      - Run verification against all consumer pact files
      - Report pass/fail for each interaction
      - Identify any contract violations

  - name: detect-breaking-changes
    description: "Compare contract versions to detect breaking changes."
    tools: ["bash", "read", "mcp:agentic-qe:contract_validate"]
    prompt: |
      Detect breaking changes:
      - Compare current contract with previous version
      - Flag breaking changes: removed fields, renamed fields, type changes
      - Flag non-breaking changes: added optional fields, new endpoints, bug fixes
      - Calculate recommended semver bump (major/minor/patch)
      - Generate migration guide if breaking changes found

  - name: ci-integration
    description: "Configure CI/CD pipeline to block deploys that break contracts."
    tools: ["read", "edit", "bash"]
    prompt: |
      Set up CI/CD integration:
      - Consumer tests publish pacts on push
      - Provider verification runs against all consumer pacts
      - "Can I deploy?" check before deployment
      - Block deploys that break existing contracts
      Generate pipeline configuration.

  - name: store-results
    description: "Store contract validation results and version compatibility matrix."
    tools: ["mcp:agentic-qe:memory_store"]
    prompt: |
      Store contract testing results:
      - Current contracts with version numbers
      - Breaking changes detected
      - Version compatibility matrix
      - Verification history
