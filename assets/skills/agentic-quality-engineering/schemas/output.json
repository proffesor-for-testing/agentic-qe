{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://agentic-qe.dev/schemas/agentic-quality-engineering-output.json",
  "title": "Agentic Quality Engineering Skill Output Schema",
  "description": "Schema for agentic quality engineering output with fleet status, agent coordination, and PACT principles validation.",
  "type": "object",
  "required": ["skillName", "version", "timestamp", "status", "trustTier", "output"],
  "properties": {
    "skillName": {
      "type": "string",
      "const": "agentic-quality-engineering",
      "description": "Must be 'agentic-quality-engineering'"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+)?$",
      "description": "Semantic version of the skill"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of output generation"
    },
    "status": {
      "type": "string",
      "enum": ["success", "partial", "failed", "skipped"],
      "description": "Overall execution status"
    },
    "trustTier": {
      "type": "integer",
      "minimum": 0,
      "maximum": 3,
      "description": "Trust tier level (3 for full validation)"
    },
    "output": {
      "type": "object",
      "required": ["summary", "fleetStatus", "agentCoordination"],
      "properties": {
        "summary": {
          "type": "string",
          "minLength": 50,
          "maxLength": 2000,
          "description": "Human-readable summary of agentic QE assessment"
        },
        "fleetStatus": {
          "$ref": "#/$defs/fleetStatus",
          "description": "Current fleet status and health"
        },
        "agentCoordination": {
          "$ref": "#/$defs/agentCoordination",
          "description": "Agent coordination state and metrics"
        },
        "pactPrinciples": {
          "$ref": "#/$defs/pactPrinciples",
          "description": "PACT principles assessment (Proactive, Autonomous, Collaborative, Targeted)"
        },
        "qualityScore": {
          "$ref": "#/$defs/qualityScore",
          "description": "Overall quality engineering score"
        },
        "findings": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/finding"
          },
          "maxItems": 100,
          "description": "Quality engineering findings"
        },
        "recommendations": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/recommendation"
          },
          "maxItems": 50,
          "description": "Recommendations for improvement"
        },
        "metrics": {
          "$ref": "#/$defs/metrics",
          "description": "Quantitative metrics"
        },
        "artifacts": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/artifact"
          },
          "maxItems": 20,
          "description": "Generated artifacts"
        }
      }
    },
    "metadata": {
      "$ref": "#/$defs/metadata"
    },
    "validation": {
      "$ref": "#/$defs/validationResult"
    },
    "learning": {
      "$ref": "#/$defs/learningData"
    }
  },
  "$defs": {
    "fleetStatus": {
      "type": "object",
      "required": ["totalAgents", "activeAgents", "topology"],
      "properties": {
        "totalAgents": {
          "type": "integer",
          "minimum": 0,
          "maximum": 50,
          "description": "Total number of agents in the fleet"
        },
        "activeAgents": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of currently active agents"
        },
        "idleAgents": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of idle agents"
        },
        "failedAgents": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of failed agents"
        },
        "topology": {
          "type": "string",
          "enum": ["hierarchical", "hierarchical-mesh", "mesh", "ring", "star", "hybrid"],
          "description": "Fleet topology configuration"
        },
        "health": {
          "type": "string",
          "enum": ["healthy", "degraded", "critical", "unknown"],
          "description": "Overall fleet health status"
        },
        "coordinatorId": {
          "type": "string",
          "description": "ID of the fleet coordinator agent"
        },
        "uptime": {
          "type": "integer",
          "minimum": 0,
          "description": "Fleet uptime in seconds"
        },
        "lastHeartbeat": {
          "type": "string",
          "format": "date-time",
          "description": "Last heartbeat timestamp"
        },
        "agents": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/agentInfo"
          },
          "description": "List of agent information"
        }
      }
    },
    "agentInfo": {
      "type": "object",
      "required": ["id", "type", "status"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^qe-[a-z][a-z0-9-]*$",
          "description": "Agent identifier"
        },
        "type": {
          "type": "string",
          "description": "Agent type/role"
        },
        "status": {
          "type": "string",
          "enum": ["active", "idle", "busy", "failed", "terminated"],
          "description": "Agent status"
        },
        "domain": {
          "type": "string",
          "description": "Agent's domain"
        },
        "tasksCompleted": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tasks completed"
        },
        "lastActivity": {
          "type": "string",
          "format": "date-time",
          "description": "Last activity timestamp"
        }
      }
    },
    "agentCoordination": {
      "type": "object",
      "required": ["coordinationMode", "tasksDistributed"],
      "properties": {
        "coordinationMode": {
          "type": "string",
          "enum": ["centralized", "distributed", "hybrid", "autonomous"],
          "description": "Coordination mode"
        },
        "tasksDistributed": {
          "type": "integer",
          "minimum": 0,
          "description": "Total tasks distributed"
        },
        "tasksCompleted": {
          "type": "integer",
          "minimum": 0,
          "description": "Tasks completed successfully"
        },
        "tasksFailed": {
          "type": "integer",
          "minimum": 0,
          "description": "Tasks that failed"
        },
        "tasksPending": {
          "type": "integer",
          "minimum": 0,
          "description": "Tasks pending execution"
        },
        "averageTaskDuration": {
          "type": "number",
          "minimum": 0,
          "description": "Average task duration in milliseconds"
        },
        "communicationLatency": {
          "type": "number",
          "minimum": 0,
          "description": "Average inter-agent communication latency in ms"
        },
        "conflictResolutions": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of coordination conflicts resolved"
        },
        "loadBalancing": {
          "type": "object",
          "properties": {
            "algorithm": {
              "type": "string",
              "enum": ["round-robin", "least-loaded", "capability-based", "adaptive"]
            },
            "efficiency": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Load balancing efficiency score"
            }
          }
        }
      }
    },
    "pactPrinciples": {
      "type": "object",
      "required": ["proactive", "autonomous", "collaborative", "targeted"],
      "properties": {
        "proactive": {
          "$ref": "#/$defs/pactDimension",
          "description": "Proactive quality measures"
        },
        "autonomous": {
          "$ref": "#/$defs/pactDimension",
          "description": "Autonomous decision-making capability"
        },
        "collaborative": {
          "$ref": "#/$defs/pactDimension",
          "description": "Collaboration effectiveness"
        },
        "targeted": {
          "$ref": "#/$defs/pactDimension",
          "description": "Targeted testing approach"
        },
        "overallScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Overall PACT score"
        }
      }
    },
    "pactDimension": {
      "type": "object",
      "required": ["score"],
      "properties": {
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Dimension score (0-100)"
        },
        "grade": {
          "type": "string",
          "pattern": "^[A-F][+-]?$",
          "description": "Letter grade"
        },
        "indicators": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Key indicators for this dimension"
        },
        "improvements": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Suggested improvements"
        }
      }
    },
    "qualityScore": {
      "type": "object",
      "required": ["value", "max"],
      "properties": {
        "value": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Quality score (0-100)"
        },
        "max": {
          "type": "number",
          "const": 100
        },
        "grade": {
          "type": "string",
          "pattern": "^[A-F][+-]?$",
          "description": "Letter grade"
        },
        "trend": {
          "type": "string",
          "enum": ["improving", "stable", "declining", "unknown"]
        },
        "breakdown": {
          "type": "object",
          "properties": {
            "testCoverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "defectDensity": {
              "type": "number",
              "minimum": 0
            },
            "automationRate": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "fleetEfficiency": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    "finding": {
      "type": "object",
      "required": ["id", "title", "severity", "category"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^AQE-\\d{3,6}$",
          "description": "Unique finding identifier"
        },
        "title": {
          "type": "string",
          "minLength": 10,
          "maxLength": 200
        },
        "description": {
          "type": "string",
          "maxLength": 2000
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low", "info"]
        },
        "category": {
          "type": "string",
          "enum": ["fleet", "coordination", "quality", "automation", "coverage", "performance"]
        },
        "affectedAgents": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "remediation": {
          "type": "string",
          "maxLength": 2000
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "recommendation": {
      "type": "object",
      "required": ["id", "title", "priority"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^REC-\\d{3,6}$"
        },
        "title": {
          "type": "string",
          "minLength": 10,
          "maxLength": 200
        },
        "description": {
          "type": "string",
          "maxLength": 2000
        },
        "priority": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "effort": {
          "type": "string",
          "enum": ["trivial", "low", "medium", "high", "major"]
        },
        "impact": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10
        },
        "relatedFindings": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^AQE-\\d{3,6}$"
          }
        }
      }
    },
    "metrics": {
      "type": "object",
      "properties": {
        "total": {
          "type": "integer",
          "minimum": 0
        },
        "passed": {
          "type": "integer",
          "minimum": 0
        },
        "failed": {
          "type": "integer",
          "minimum": 0
        },
        "duration": {
          "type": "integer",
          "minimum": 0,
          "description": "Duration in milliseconds"
        },
        "custom": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "artifact": {
      "type": "object",
      "required": ["type", "path"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["report", "data", "screenshot", "log", "config"]
        },
        "path": {
          "type": "string",
          "maxLength": 500
        },
        "format": {
          "type": "string",
          "enum": ["json", "html", "md", "txt", "png", "csv", "yaml"]
        },
        "description": {
          "type": "string",
          "maxLength": 500
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "executionTimeMs": {
          "type": "integer",
          "minimum": 0,
          "maximum": 600000
        },
        "toolsUsed": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "agentId": {
          "type": "string"
        },
        "modelUsed": {
          "type": "string"
        },
        "environment": {
          "type": "string",
          "enum": ["development", "staging", "production", "ci"]
        }
      }
    },
    "validationResult": {
      "type": "object",
      "properties": {
        "schemaValid": {
          "type": "boolean"
        },
        "contentValid": {
          "type": "boolean"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "errors": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "learningData": {
      "type": "object",
      "properties": {
        "patternsDetected": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "reward": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "feedbackLoop": {
          "type": "object",
          "properties": {
            "previousRunId": {
              "type": "string"
            },
            "improvement": {
              "type": "number",
              "minimum": -1,
              "maximum": 1
            }
          }
        }
      }
    }
  }
}
