@startuml C4_Component
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Agentic QE Fleet - Code Intelligence Component Diagram

Container_Boundary(codeIntel, "Code Intelligence") {
    Component(orchestrator, "CodeIntelligenceOrchestrator", "TypeScript", "Main coordinator for indexing, querying, and stats")
    Component(indexer, "IncrementalIndexer", "TypeScript", "File parsing, chunking, incremental updates")
    Component(graphBuilder, "GraphBuilder", "TypeScript", "Knowledge graph construction with entities and relationships")
    Component(searchEngine, "HybridSearchEngine", "TypeScript", "Semantic + keyword search with graph expansion")
    Component(codeRouter, "CodeIntelligenceHybridRouter", "TypeScript", "Routes between local (Ollama) and cloud providers")
    Component(service, "CodeIntelligenceService", "TypeScript", "Singleton service for agent injection")
}

System_Ext(ollama, "Ollama", "nomic-embed-text model")
System_Ext(ruvector, "RuVector PostgreSQL", "pgvector extension")

Rel(orchestrator, indexer, "Uses", "File processing")
Rel(orchestrator, graphBuilder, "Uses", "Graph construction")
Rel(orchestrator, searchEngine, "Uses", "Query execution")
Rel(orchestrator, codeRouter, "Uses", "Embedding & storage")
Rel(service, orchestrator, "Wraps", "Singleton access")

Rel(indexer, codeRouter, "Stores", "Code chunks")
Rel(graphBuilder, codeRouter, "Stores", "Entities, relationships")
Rel(searchEngine, codeRouter, "Queries", "Semantic search")

Rel(codeRouter, ollama, "Generates", "Embeddings")
Rel(codeRouter, ruvector, "Persists", "Vectors, entities, relationships")

@enduml
