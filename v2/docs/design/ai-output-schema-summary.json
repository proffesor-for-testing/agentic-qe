{
  "schemaVersion": "1.0.0",
  "createdAt": "2025-12-12T00:00:00.000Z",
  "description": "AI-Friendly Output Format Schema Summary for Memory Storage",
  "architectureDecision": "ADR-C1.1",

  "outputTypes": {
    "test_results": {
      "description": "Test execution results with failures, flaky tests, and coverage",
      "keyFields": ["summary", "suites", "failures", "flaky", "coverage"],
      "actions": ["fix_test_failures", "stabilize_flaky_tests", "increase_coverage"]
    },
    "coverage_report": {
      "description": "Code coverage analysis with gaps and trends",
      "keyFields": ["summary", "trend", "gaps", "files"],
      "actions": ["increase_coverage", "review_coverage_trend"]
    },
    "agent_status": {
      "description": "Agent health, capabilities, and configuration",
      "keyFields": ["agent", "dependencies", "configuration"],
      "actions": ["agent_ready"]
    },
    "quality_metrics": {
      "description": "Overall quality assessment with gates and technical debt",
      "keyFields": ["overallScore", "grade", "dimensions", "qualityGates", "codeSmells", "technicalDebt"],
      "actions": ["reduce_complexity", "fix_code_smells", "fix_vulnerabilities"]
    }
  },

  "actionTypes": {
    "fix_test_failures": {
      "priority": ["critical", "high"],
      "automation": "limited",
      "confidence": 0.65,
      "description": "Guide user to fix failing tests with specific steps"
    },
    "stabilize_flaky_tests": {
      "priority": ["high", "medium"],
      "automation": "high",
      "confidence": 0.78,
      "description": "Auto-stabilize flaky tests using pattern analysis"
    },
    "increase_coverage": {
      "priority": ["critical", "high", "medium"],
      "automation": "high",
      "confidence": 0.92,
      "description": "Generate tests to increase coverage in critical areas"
    },
    "reduce_complexity": {
      "priority": ["high", "medium"],
      "automation": "limited",
      "confidence": 0.45,
      "description": "Suggest refactoring for complex code"
    },
    "fix_vulnerabilities": {
      "priority": ["critical", "high"],
      "automation": "medium",
      "confidence": 0.95,
      "description": "Auto-patch security vulnerabilities"
    },
    "optimize_performance": {
      "priority": ["high", "medium", "low"],
      "automation": "medium",
      "confidence": 0.55,
      "description": "Profile and suggest performance optimizations"
    },
    "fix_code_smells": {
      "priority": ["medium", "low"],
      "automation": "high",
      "confidence": 0.82,
      "description": "Auto-refactor code smells and duplications"
    },
    "update_dependencies": {
      "priority": ["medium", "low"],
      "automation": "high",
      "confidence": 0.90,
      "description": "Automated dependency updates"
    },
    "review_coverage_trend": {
      "priority": ["low", "info"],
      "automation": "none",
      "confidence": 1.0,
      "description": "Informational coverage trend monitoring"
    },
    "agent_ready": {
      "priority": ["info"],
      "automation": "none",
      "confidence": 1.0,
      "description": "Confirmation that agent is ready for tasks"
    }
  },

  "environmentDetection": {
    "variables": {
      "AQE_AI_OUTPUT": {
        "values": ["0", "1"],
        "default": "0",
        "description": "Explicit AI mode control"
      },
      "CLAUDECODE": {
        "values": ["0", "1"],
        "autoDetected": true,
        "description": "Claude Code session indicator"
      },
      "CURSOR_AI": {
        "values": ["0", "1"],
        "autoDetected": true,
        "description": "Cursor AI session indicator"
      },
      "AIDER_AI": {
        "values": ["0", "1"],
        "autoDetected": true,
        "description": "Aider AI session indicator"
      },
      "AQE_OUTPUT_VERSION": {
        "values": ["1.0.0"],
        "default": "1.0.0",
        "description": "Force specific schema version"
      },
      "AQE_OUTPUT_PRETTY": {
        "values": ["0", "1"],
        "default": "0",
        "description": "Pretty-print JSON output"
      },
      "AQE_OUTPUT_STREAM": {
        "values": ["0", "1"],
        "default": "0",
        "description": "Enable streaming for long operations"
      }
    },
    "detectionLogic": "AQE_AI_OUTPUT=1 || CLAUDECODE=1 || CURSOR_AI=1 || AIDER_AI=1 -> AI mode, else HUMAN mode"
  },

  "performanceTarget": {
    "parsingSpeed": "100x faster than natural language",
    "determinism": "Same input produces identical JSON",
    "overhead": "< 5ms for schema generation"
  },

  "versioningStrategy": {
    "format": "semantic versioning (MAJOR.MINOR.PATCH)",
    "compatibility": "Major version must match for compatibility",
    "evolution": "Additive changes only within major version",
    "deprecation": "Clear warnings for obsolete fields"
  },

  "streamingSupport": {
    "enabled": true,
    "types": ["start", "progress", "complete", "error"],
    "format": "newline-delimited JSON (NDJSON)",
    "useCase": "Long-running operations (test execution, coverage analysis)"
  },

  "integrations": {
    "claudeCode": {
      "autoDetect": true,
      "variable": "CLAUDECODE",
      "defaultMode": "AI"
    },
    "cursorAI": {
      "autoDetect": true,
      "variable": "CURSOR_AI",
      "defaultMode": "AI"
    },
    "cicd": {
      "recommended": "AI mode for structured logs",
      "parsingTools": "jq, yq, JSON parsers"
    }
  },

  "files": {
    "specification": "/workspaces/agentic-qe-cf/docs/design/ai-output-format-spec.md",
    "implementation": "/workspaces/agentic-qe-cf/src/output/OutputFormatter.ts",
    "index": "/workspaces/agentic-qe-cf/src/output/index.ts",
    "examples": "/workspaces/agentic-qe-cf/docs/design/ai-output-format-spec.md#examples"
  }
}
