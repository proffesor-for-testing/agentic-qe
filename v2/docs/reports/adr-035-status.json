{
  "adr": "ADR-035",
  "title": "Causal Discovery for Root Cause Analysis",
  "status": "COMPLETE",
  "implementedAt": "2026-01-11T12:21:00Z",
  "summary": "STDP-based spike timing correlation for automated root cause analysis in Agentic QE v3",

  "implementation": {
    "complete": true,
    "components": [
      {
        "name": "CausalWeightMatrix",
        "file": "/workspaces/agentic-qe/v3/src/causal-discovery/weight-matrix.ts",
        "linesOfCode": 290,
        "description": "STDP-based learning rule for causal weight updates",
        "features": [
          "Asymmetric STDP timing function (potentiation/depression)",
          "Exponential decay for weight pruning",
          "Time-based decay for temporal forgetting",
          "Weight serialization/deserialization",
          "Matrix merging for distributed learning"
        ]
      },
      {
        "name": "CausalGraphImpl",
        "file": "/workspaces/agentic-qe/v3/src/causal-discovery/causal-graph.ts",
        "linesOfCode": 320,
        "description": "Graph operations for causal analysis",
        "features": [
          "Reachability analysis (BFS)",
          "Transitive closure (Floyd-Warshall)",
          "Path finding with cycle detection",
          "Strongly connected components (Tarjan's algorithm)",
          "Intervention point identification",
          "Subgraph extraction"
        ]
      },
      {
        "name": "CausalDiscoveryEngine",
        "file": "/workspaces/agentic-qe/v3/src/causal-discovery/discovery-engine.ts",
        "linesOfCode": 280,
        "description": "Main engine for observation and root cause analysis",
        "features": [
          "Event observation with STDP learning",
          "Batch event processing",
          "Root cause analysis with direct/indirect causes",
          "Intervention point recommendations",
          "Confidence scoring based on evidence",
          "Cause/effect prediction",
          "JSON serialization for persistence"
        ]
      },
      {
        "name": "CausalRootCauseAnalyzerService",
        "file": "/workspaces/agentic-qe/v3/src/domains/defect-intelligence/services/causal-root-cause-analyzer.ts",
        "linesOfCode": 320,
        "description": "Integration with defect-intelligence domain",
        "features": [
          "Human-readable analysis summaries",
          "Memory backend persistence",
          "Auto-persist capability",
          "Test result event conversion helpers"
        ]
      },
      {
        "name": "Types",
        "file": "/workspaces/agentic-qe/v3/src/causal-discovery/types.ts",
        "linesOfCode": 220,
        "description": "Comprehensive type definitions",
        "features": [
          "35 TestEventType variants",
          "Configuration interfaces",
          "STDP parameters",
          "Causal graph types",
          "Root cause analysis types"
        ]
      }
    ],
    "totalLinesOfCode": 1430
  },

  "tests": {
    "totalTests": 103,
    "passed": 103,
    "failed": 0,
    "skipped": 0,
    "testFiles": [
      {
        "file": "tests/unit/causal-discovery/weight-matrix.test.ts",
        "tests": 23,
        "coverage": [
          "STDP learning rule",
          "Weight accumulation",
          "Decay operations",
          "Graph extraction",
          "Serialization",
          "Matrix merging"
        ]
      },
      {
        "file": "tests/unit/causal-discovery/causal-graph.test.ts",
        "tests": 28,
        "coverage": [
          "Edge queries",
          "Reachability",
          "Transitive closure",
          "Path finding",
          "Strongly connected components",
          "Cycle detection",
          "Intervention points"
        ]
      },
      {
        "file": "tests/unit/causal-discovery/discovery-engine.test.ts",
        "tests": 26,
        "coverage": [
          "Event observation",
          "Root cause analysis",
          "Prediction",
          "Summary statistics",
          "Serialization",
          "Complex scenarios"
        ]
      },
      {
        "file": "tests/unit/causal-discovery/causal-root-cause-analyzer.test.ts",
        "tests": 26,
        "coverage": [
          "Service initialization",
          "Event observation",
          "Root cause analysis",
          "Predictions",
          "Persistence",
          "Event helpers"
        ]
      }
    ]
  },

  "algorithms": {
    "stdp": {
      "name": "Spike-Timing Dependent Plasticity",
      "description": "Biological learning rule where synaptic strength changes based on relative timing of pre/post-synaptic spikes",
      "implementation": "Asymmetric exponential windows for potentiation (pre before post) and depression (post before pre)",
      "parameters": {
        "aPlus": 0.01,
        "aMinus": 0.005,
        "tauPlus": 20,
        "tauMinus": 20
      }
    },
    "floydWarshall": {
      "name": "Floyd-Warshall Transitive Closure",
      "description": "Computes all transitive causal relationships in O(n^3) time",
      "useCase": "Finding indirect causal paths between events"
    },
    "tarjan": {
      "name": "Tarjan's Strongly Connected Components",
      "description": "Identifies feedback loops in the causal graph",
      "useCase": "Detecting cyclic causal patterns"
    }
  },

  "integration": {
    "defectIntelligence": {
      "integrated": true,
      "service": "CausalRootCauseAnalyzerService",
      "exports": [
        "createCausalRootCauseAnalyzer",
        "createTestEvent",
        "testResultToEvents"
      ]
    }
  },

  "successCriteria": {
    "causalRelationshipLearning": {
      "met": true,
      "description": "System learns causal relationships from event streams using STDP"
    },
    "rootCauseIdentification": {
      "met": true,
      "description": "Identifies direct and indirect causes with confidence scores"
    },
    "interventionPointSuggestions": {
      "met": true,
      "description": "Recommends optimal intervention points based on graph analysis"
    },
    "transitiveClosureComputation": {
      "met": true,
      "description": "Computes transitive closure using Floyd-Warshall algorithm"
    },
    "defectIntelligenceIntegration": {
      "met": true,
      "description": "Integrated with defect-intelligence domain via CausalRootCauseAnalyzerService"
    },
    "testCoverage": {
      "met": true,
      "description": "103 tests covering all components",
      "required": 50,
      "actual": 103
    }
  },

  "filesCreated": [
    "/workspaces/agentic-qe/v3/src/causal-discovery/types.ts",
    "/workspaces/agentic-qe/v3/src/causal-discovery/weight-matrix.ts",
    "/workspaces/agentic-qe/v3/src/causal-discovery/causal-graph.ts",
    "/workspaces/agentic-qe/v3/src/causal-discovery/discovery-engine.ts",
    "/workspaces/agentic-qe/v3/src/causal-discovery/index.ts",
    "/workspaces/agentic-qe/v3/src/domains/defect-intelligence/services/causal-root-cause-analyzer.ts",
    "/workspaces/agentic-qe/v3/tests/unit/causal-discovery/weight-matrix.test.ts",
    "/workspaces/agentic-qe/v3/tests/unit/causal-discovery/causal-graph.test.ts",
    "/workspaces/agentic-qe/v3/tests/unit/causal-discovery/discovery-engine.test.ts",
    "/workspaces/agentic-qe/v3/tests/unit/causal-discovery/causal-root-cause-analyzer.test.ts"
  ],

  "filesModified": [
    "/workspaces/agentic-qe/v3/src/domains/defect-intelligence/services/index.ts"
  ],

  "references": [
    {
      "name": "RuVector causal.rs",
      "url": "https://github.com/ruvnet/ruvector/blob/main/crates/ruvector-mincut/src/snn/causal.rs"
    },
    {
      "name": "Spike-Timing Dependent Plasticity (STDP)",
      "url": "https://en.wikipedia.org/wiki/Spike-timing-dependent_plasticity"
    },
    {
      "name": "Granger Causality",
      "url": "https://en.wikipedia.org/wiki/Granger_causality"
    }
  ]
}
