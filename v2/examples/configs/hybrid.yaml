# Hybrid Deployment Mode
# Intelligently balances between local and hosted providers
# Ideal for: Teams with varied workloads, adaptive cost optimization

mode: hybrid

# Provider configuration
providers:
  # Local providers (high priority for simple tasks)
  - type: ollama
    enabled: true
    priority: 15
    baseUrl: http://localhost:11434
    defaultModel: llama3.2:3b

    # Use local for lightweight tasks
    modelOverrides:
      documentation: llama3.2:3b
      coverage-analysis: llama3.2:3b

    costPer1MTokens:
      input: 0
      output: 0

    fallbackProvider: groq

  # Fast hosted inference (medium priority)
  - type: groq
    enabled: true
    priority: 10
    apiKey: ${GROQ_API_KEY}
    baseUrl: https://api.groq.com/openai/v1
    defaultModel: llama-3.3-70b-versatile

    # Use Groq for complex tasks requiring speed
    modelOverrides:
      test-generation: llama-3.3-70b-versatile
      refactoring: llama-3.3-70b-versatile
      performance-testing: llama-3.1-70b-versatile

    costPer1MTokens:
      input: 0.59
      output: 0.79

    limits:
      requestsPerMinute: 30
      tokensPerMinute: 20000

    fallbackProvider: openrouter

  # Premium quality (low priority, for critical tasks)
  - type: openrouter
    enabled: true
    priority: 20
    apiKey: ${OPENROUTER_API_KEY}
    baseUrl: https://openrouter.ai/api/v1
    defaultModel: anthropic/claude-3.5-sonnet

    # Use premium models for security and complex reviews
    modelOverrides:
      code-review: anthropic/claude-3.5-sonnet
      security-scanning: anthropic/claude-3.5-sonnet
      bug-detection: anthropic/claude-3.5-haiku

    costPer1MTokens:
      input: 3.0
      output: 15.0
      cacheReadMultiplier: 0.1
      cacheWriteMultiplier: 1.25

# Intelligent fallback chain
# Simple tasks: Ollama -> Groq -> OpenRouter
# Complex tasks: Groq -> OpenRouter
fallbackChain:
  - ollama
  - groq
  - openrouter

# Moderate cost budget
costBudget:
  daily: 10.0
  monthly: 250.0
  warnThreshold: 75
  enforceLimit: true

# Health monitoring
enableHealthChecks: true
healthCheckInterval: 120000  # 2 minutes
maxConsecutiveFailures: 3

# Retry configuration
enableRetries: true
maxRetries: 3

# Caching optimization
enableCaching: true
cacheTTL: 1800  # 30 minutes

# Cost tracking
enableCostTracking: true

# Logging
logLevel: info
