/**
 * Agentic QE v3 - MCP Security: CVE Prevention Utilities
 * Security utilities for preventing common vulnerabilities (ADR-012)
 *
 * This file serves as a facade that maintains backward compatibility
 * while the actual implementations are organized using the Strategy Pattern
 * in the validators/ directory.
 *
 * Features:
 * - Path traversal protection (no ../ in paths)
 * - ReDoS prevention with regex escaping
 * - Timing-safe authentication comparison
 * - Input sanitization utilities
 * - Command injection prevention
 */

// ============================================================================
// Re-export Types and Interfaces
// ============================================================================

export type {
  // Result types
  PathValidationResult,
  RegexSafetyResult,
  CommandValidationResult,

  // Options types
  SanitizationOptions,
  PathValidationOptions,
} from './validators/interfaces';

// Re-export RiskLevel as a type (it's used in PathValidationResult)
export type { RiskLevel } from './validators/interfaces';

// ============================================================================
// Re-export Validators and Functions
// ============================================================================

// Path Traversal Protection
export {
  validatePath,
  normalizePath,
  joinPaths,
  joinPathsAbsolute,
  getExtension,
  PathTraversalValidator,
  PATH_TRAVERSAL_PATTERNS,
  DANGEROUS_PATH_COMPONENTS,
} from './validators/path-traversal-validator';

// ReDoS Prevention
export {
  isRegexSafe,
  escapeRegex,
  createSafeRegex,
  RegexSafetyValidator,
  REDOS_PATTERNS,
  countQuantifierNesting,
  hasExponentialBacktracking,
} from './validators/regex-safety-validator';

// Timing-Safe Comparison
export {
  timingSafeCompare,
  timingSafeHashCompare,
  generateSecureToken,
  secureHash,
  CryptoValidator,
} from './validators/crypto-validator';

// Input Sanitization
export {
  sanitizeInput,
  escapeHtml,
  stripHtmlTags,
  InputSanitizer,
  HTML_ESCAPE_MAP,
  SQL_INJECTION_PATTERNS,
  SHELL_METACHARACTERS,
  DANGEROUS_CONTROL_CHARS,
} from './validators/input-sanitizer';

// Command Injection Prevention
export {
  validateCommand,
  escapeShellArg,
  CommandValidator,
  DEFAULT_ALLOWED_COMMANDS,
  BLOCKED_COMMAND_PATTERNS,
} from './validators/command-validator';

// ============================================================================
// Re-export Orchestrator
// ============================================================================

export {
  ValidationOrchestrator,
  getOrchestrator,
  createOrchestrator,
} from './validators/validation-orchestrator';

// ============================================================================
// Import for CVEPrevention Object
// ============================================================================

import { validatePath } from './validators/path-traversal-validator';
import { normalizePath } from './validators/path-traversal-validator';
import { joinPaths } from './validators/path-traversal-validator';
import { joinPathsAbsolute } from './validators/path-traversal-validator';
import { getExtension } from './validators/path-traversal-validator';
import { isRegexSafe } from './validators/regex-safety-validator';
import { escapeRegex } from './validators/regex-safety-validator';
import { createSafeRegex } from './validators/regex-safety-validator';
import { timingSafeCompare } from './validators/crypto-validator';
import { timingSafeHashCompare } from './validators/crypto-validator';
import { generateSecureToken } from './validators/crypto-validator';
import { secureHash } from './validators/crypto-validator';
import { sanitizeInput } from './validators/input-sanitizer';
import { escapeHtml } from './validators/input-sanitizer';
import { stripHtmlTags } from './validators/input-sanitizer';
import { validateCommand } from './validators/command-validator';
import { escapeShellArg } from './validators/command-validator';

// ============================================================================
// Export Utilities Object (Backward Compatibility)
// ============================================================================

/**
 * CVEPrevention - Main security utilities object
 * Provides backward-compatible access to all security functions
 */
export const CVEPrevention = {
  // Path traversal
  validatePath,
  normalizePath,
  joinPaths,
  joinPathsAbsolute,
  getExtension,

  // ReDoS
  isRegexSafe,
  escapeRegex,
  createSafeRegex,

  // Timing-safe
  timingSafeCompare,
  timingSafeHashCompare,
  generateSecureToken,
  secureHash,

  // Input sanitization
  sanitizeInput,
  escapeHtml,
  stripHtmlTags,

  // Command injection
  validateCommand,
  escapeShellArg,
};

export default CVEPrevention;
