# Gitleaks Configuration for Agentic QE v3
# Purpose: Exclude false positives from security scans
# Created: 2026-01-24 (Phase 1: Quality Remediation Plan)

title = "Agentic QE v3 Gitleaks Configuration"

[extend]
# Use default rules as base
useDefault = true

# =============================================================================
# ALLOWLIST: Known False Positives
# =============================================================================
# These patterns are flagged by the AWS secret key regex but are NOT actual secrets.
# They are chalk terminal formatting strings in CLI wizard files.

[allowlist]
description = "Allowlist for known false positives"

# Paths to ignore entirely (development/test files)
paths = [
    '''v3/tests/.*''',
    '''.*\.test\.ts$''',
    '''.*\.spec\.ts$''',
    '''.*/__mocks__/.*''',
    '''.*/__fixtures__/.*''',
]

# Specific regex patterns to ignore
regexes = [
    # Chalk formatting strings that trigger AWS key detection
    # Pattern: chalk.blue('===...') creates strings matching AKIA[A-Z0-9]{16}
    '''chalk\.(blue|green|red|yellow|cyan|magenta|white|gray|bold)\(['"].*['"]\)''',

    # Console.log with chalk formatting
    '''console\.log\(chalk\..*\)''',

    # ScanType enum values like 'secret', 'sast', 'dast'
    '''ScanType\s*[=:]\s*['"]?(secret|sast|dast|vulnerability)['"]?''',
]

# Specific commits to ignore (if needed)
commits = []

# =============================================================================
# RULE OVERRIDES: Reduce False Positives
# =============================================================================

[[rules]]
id = "aws-access-key-id"
description = "AWS Access Key ID"
regex = '''(A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'''
keywords = ["akia", "agpa", "aida", "aroa", "aipa", "anpa", "anva", "asia", "a3t"]

# Paths where this rule should NOT apply (wizard UI files)
[rules.allowlist]
paths = [
    '''v3/src/cli/wizards/.*\.ts$''',
    '''v3/src/cli/commands/.*\.ts$''',
]
regexTarget = "match"

[[rules]]
id = "aws-secret-access-key"
description = "AWS Secret Access Key"
regex = '''(?i)aws_?secret_?access_?key\s*[=:]\s*['"]?[A-Za-z0-9/+=]{40}['"]?'''
keywords = ["aws_secret_access_key", "aws-secret-access-key"]

# Exclude wizard files from this rule
[rules.allowlist]
paths = [
    '''v3/src/cli/wizards/.*\.ts$''',
]

[[rules]]
id = "generic-credential"
description = "Generic Credential"
regex = '''(?i)(password|secret|token|key|credential)\s*[=:]\s*['"][^'"]{8,}['"]'''
keywords = ["password", "secret", "token", "key", "credential"]

# Exclude configuration examples and wizard prompts
[rules.allowlist]
paths = [
    '''v3/src/cli/wizards/.*\.ts$''',
    '''v3/docs/.*''',
    '''.*\.md$''',
]
regexes = [
    # Exclude placeholder/example patterns
    '''['"]<.*>['"]''',
    '''['"]your-.*-here['"]''',
    '''['"]example-.*['"]''',
    '''process\.env\..*''',
]

# =============================================================================
# ADDITIONAL RULES: Ensure Real Issues Are Caught
# =============================================================================

[[rules]]
id = "hardcoded-env-file"
description = "Hardcoded .env file content"
regex = '''(?i)(DATABASE_URL|API_KEY|SECRET_KEY|PRIVATE_KEY)\s*=\s*['"]?[^'"${\s]+['"]?'''
path = '''\.env.*'''
keywords = ["database_url", "api_key", "secret_key", "private_key"]

[[rules]]
id = "private-key-block"
description = "Private Key Block"
regex = '''-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----'''
keywords = ["begin", "private", "key"]

[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[A-Za-z0-9-_]+\.eyJ[A-Za-z0-9-_]+\.[A-Za-z0-9-_.+/=]+'''
keywords = ["eyj"]
