{
  "id": "code-review",
  "name": "Code Review Constitution",
  "version": "1.0.0",
  "description": "Constitution governing the qe-code-reviewer agent, defining principles for code quality assessment, security checks, and maintainability standards",
  "principles": [
    {
      "id": "code-quality",
      "name": "Code Quality",
      "description": "Code must be clean, readable, and follow established patterns and best practices.",
      "priority": "critical",
      "category": "quality",
      "mandatory": true,
      "tags": ["quality", "clean-code", "best-practices"]
    },
    {
      "id": "security-first",
      "name": "Security First",
      "description": "All code must be reviewed for security vulnerabilities and follow secure coding practices.",
      "priority": "critical",
      "category": "security",
      "mandatory": true,
      "tags": ["security", "vulnerabilities", "owasp"]
    },
    {
      "id": "maintainability",
      "name": "Maintainability",
      "description": "Code should be easy to understand, modify, and extend by other developers.",
      "priority": "high",
      "category": "maintainability",
      "mandatory": true,
      "tags": ["maintainability", "readability", "modularity"]
    },
    {
      "id": "documentation-completeness",
      "name": "Documentation Completeness",
      "description": "Public APIs, complex logic, and business rules must be properly documented.",
      "priority": "medium",
      "category": "documentation",
      "tags": ["documentation", "comments", "api-docs"]
    },
    {
      "id": "performance-efficiency",
      "name": "Performance Efficiency",
      "description": "Code should be efficient and avoid unnecessary resource consumption.",
      "priority": "medium",
      "category": "performance",
      "tags": ["performance", "optimization", "efficiency"]
    },
    {
      "id": "error-handling",
      "name": "Robust Error Handling",
      "description": "Code must handle errors gracefully and provide meaningful error messages.",
      "priority": "high",
      "category": "reliability",
      "tags": ["error-handling", "exceptions", "resilience"]
    },
    {
      "id": "solid-principles",
      "name": "SOLID Principles",
      "description": "Code should follow SOLID principles for object-oriented design.",
      "priority": "medium",
      "category": "design",
      "tags": ["solid", "design-patterns", "architecture"]
    }
  ],
  "rules": [
    {
      "id": "max-complexity",
      "name": "Maximum Cyclomatic Complexity",
      "principleId": "maintainability",
      "condition": {
        "field": "cyclomatic_complexity",
        "operator": "greater_than",
        "value": 10
      },
      "action": {
        "type": "fail",
        "message": "Cyclomatic complexity exceeds 10. Refactor to reduce complexity.",
        "stopProcessing": false
      },
      "severity": "error",
      "enabled": true,
      "description": "Limits function complexity for maintainability",
      "remediation": "Break down complex functions into smaller, focused functions"
    },
    {
      "id": "max-function-length",
      "name": "Maximum Function Length",
      "principleId": "maintainability",
      "condition": {
        "field": "function_lines",
        "operator": "greater_than",
        "value": 50
      },
      "action": {
        "type": "warn",
        "message": "Function exceeds 50 lines. Consider breaking into smaller functions."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Limits function length for readability"
    },
    {
      "id": "max-file-length",
      "name": "Maximum File Length",
      "principleId": "maintainability",
      "condition": {
        "field": "file_lines",
        "operator": "greater_than",
        "value": 500
      },
      "action": {
        "type": "warn",
        "message": "File exceeds 500 lines. Consider splitting into modules."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Limits file length for maintainability"
    },
    {
      "id": "no-hardcoded-secrets",
      "name": "No Hardcoded Secrets",
      "principleId": "security-first",
      "condition": {
        "field": "hardcoded_secrets_detected",
        "operator": "equals",
        "value": true
      },
      "action": {
        "type": "fail",
        "message": "Hardcoded secrets detected. Use environment variables or secret management.",
        "stopProcessing": true
      },
      "severity": "error",
      "enabled": true,
      "description": "Detects hardcoded passwords, API keys, and tokens",
      "remediation": "Move secrets to environment variables or a secret manager"
    },
    {
      "id": "sql-injection-prevention",
      "name": "SQL Injection Prevention",
      "principleId": "security-first",
      "condition": {
        "field": "potential_sql_injection",
        "operator": "equals",
        "value": true
      },
      "action": {
        "type": "fail",
        "message": "Potential SQL injection vulnerability detected. Use parameterized queries.",
        "stopProcessing": true
      },
      "severity": "error",
      "enabled": true,
      "description": "Detects potential SQL injection vulnerabilities",
      "remediation": "Use parameterized queries or ORM methods"
    },
    {
      "id": "xss-prevention",
      "name": "XSS Prevention",
      "principleId": "security-first",
      "condition": {
        "field": "potential_xss",
        "operator": "equals",
        "value": true
      },
      "action": {
        "type": "fail",
        "message": "Potential XSS vulnerability detected. Sanitize user input.",
        "stopProcessing": true
      },
      "severity": "error",
      "enabled": true,
      "description": "Detects potential cross-site scripting vulnerabilities"
    },
    {
      "id": "documentation-coverage",
      "name": "Documentation Coverage",
      "principleId": "documentation-completeness",
      "condition": {
        "field": "doc_coverage",
        "operator": "less_than",
        "value": 70
      },
      "action": {
        "type": "warn",
        "message": "Documentation coverage is below 70%. Add JSDoc/comments for public APIs."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Checks for adequate documentation"
    },
    {
      "id": "error-handling-present",
      "name": "Error Handling Present",
      "principleId": "error-handling",
      "condition": {
        "field": "unhandled_errors",
        "operator": "greater_than",
        "value": 0
      },
      "action": {
        "type": "warn",
        "message": "Unhandled error paths detected. Add try-catch or error callbacks."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Detects missing error handling"
    },
    {
      "id": "code-duplication",
      "name": "Code Duplication",
      "principleId": "maintainability",
      "condition": {
        "field": "duplication_percentage",
        "operator": "greater_than",
        "value": 5
      },
      "action": {
        "type": "warn",
        "message": "Code duplication exceeds 5%. Consider extracting common code."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Detects excessive code duplication"
    },
    {
      "id": "security-score-minimum",
      "name": "Minimum Security Score",
      "principleId": "security-first",
      "condition": {
        "field": "security_score",
        "operator": "less_than",
        "value": 80
      },
      "action": {
        "type": "fail",
        "message": "Security score is below 80. Address security issues before proceeding.",
        "stopProcessing": true
      },
      "severity": "error",
      "enabled": true,
      "description": "Enforces minimum security score"
    }
  ],
  "metrics": [
    {
      "id": "cyclomatic-complexity",
      "name": "Cyclomatic Complexity",
      "description": "Average cyclomatic complexity of functions",
      "unit": "complexity",
      "aggregation": "avg",
      "dataType": "number",
      "higherIsBetter": false,
      "targetValue": 5,
      "warningThreshold": 10,
      "criticalThreshold": 15
    },
    {
      "id": "cognitive-complexity",
      "name": "Cognitive Complexity",
      "description": "Measure of how difficult the code is to understand",
      "unit": "points",
      "aggregation": "avg",
      "dataType": "number",
      "higherIsBetter": false,
      "targetValue": 10,
      "warningThreshold": 15,
      "criticalThreshold": 25
    },
    {
      "id": "security-score",
      "name": "Security Score",
      "description": "Overall security assessment score",
      "unit": "points",
      "aggregation": "min",
      "dataType": "number",
      "higherIsBetter": true,
      "targetValue": 95,
      "warningThreshold": 80,
      "criticalThreshold": 60
    },
    {
      "id": "doc-coverage",
      "name": "Documentation Coverage",
      "description": "Percentage of public APIs with documentation",
      "unit": "percent",
      "aggregation": "avg",
      "dataType": "percentage",
      "higherIsBetter": true,
      "targetValue": 90,
      "warningThreshold": 70,
      "criticalThreshold": 50
    },
    {
      "id": "duplication-percentage",
      "name": "Code Duplication",
      "description": "Percentage of duplicated code",
      "unit": "percent",
      "aggregation": "avg",
      "dataType": "percentage",
      "higherIsBetter": false,
      "targetValue": 0,
      "warningThreshold": 5,
      "criticalThreshold": 10
    },
    {
      "id": "maintainability-index",
      "name": "Maintainability Index",
      "description": "Software Engineering Institute's maintainability index",
      "unit": "index",
      "aggregation": "avg",
      "dataType": "number",
      "higherIsBetter": true,
      "targetValue": 85,
      "warningThreshold": 65,
      "criticalThreshold": 50
    },
    {
      "id": "technical-debt-ratio",
      "name": "Technical Debt Ratio",
      "description": "Ratio of time to fix issues vs development time",
      "unit": "percent",
      "aggregation": "avg",
      "dataType": "percentage",
      "higherIsBetter": false,
      "targetValue": 5,
      "warningThreshold": 10,
      "criticalThreshold": 20
    },
    {
      "id": "vulnerability-count",
      "name": "Vulnerability Count",
      "description": "Number of security vulnerabilities found",
      "unit": "issues",
      "aggregation": "sum",
      "dataType": "count",
      "higherIsBetter": false,
      "targetValue": 0,
      "warningThreshold": 1,
      "criticalThreshold": 5
    },
    {
      "id": "code-smell-count",
      "name": "Code Smell Count",
      "description": "Number of code smells detected",
      "unit": "smells",
      "aggregation": "sum",
      "dataType": "count",
      "higherIsBetter": false,
      "targetValue": 0,
      "warningThreshold": 10,
      "criticalThreshold": 25
    }
  ],
  "thresholds": [
    {
      "id": "complexity-gate",
      "metricId": "cyclomatic-complexity",
      "name": "Complexity Gate",
      "mode": "absolute",
      "warning": 10,
      "critical": 15,
      "target": 5,
      "blocking": true
    },
    {
      "id": "security-gate",
      "metricId": "security-score",
      "name": "Security Gate",
      "mode": "absolute",
      "warning": 80,
      "critical": 60,
      "target": 95,
      "blocking": true
    },
    {
      "id": "documentation-gate",
      "metricId": "doc-coverage",
      "name": "Documentation Gate",
      "mode": "percentage",
      "warning": 70,
      "critical": 50,
      "target": 90,
      "blocking": false
    },
    {
      "id": "maintainability-gate",
      "metricId": "maintainability-index",
      "name": "Maintainability Gate",
      "mode": "absolute",
      "warning": 65,
      "critical": 50,
      "target": 85,
      "blocking": false
    },
    {
      "id": "vulnerability-gate",
      "metricId": "vulnerability-count",
      "name": "Vulnerability Gate",
      "mode": "absolute",
      "warning": 1,
      "critical": 5,
      "target": 0,
      "blocking": true
    }
  ],
  "metadata": {
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-11-19T00:00:00Z",
    "author": "Agentic QE Fleet",
    "applicableTo": ["code-reviewer", "qe-code-reviewer", "quality-analyzer"],
    "inheritsFrom": "default",
    "status": "active",
    "changelog": [
      {
        "version": "1.0.0",
        "date": "2024-11-19T00:00:00Z",
        "description": "Initial release of code review constitution",
        "author": "Constitution Schema Designer"
      }
    ]
  }
}
