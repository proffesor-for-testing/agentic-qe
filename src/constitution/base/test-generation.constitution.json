{
  "id": "test-generation",
  "name": "Test Generation Constitution",
  "version": "1.0.0",
  "description": "Constitution governing the qe-test-generator agent, defining principles for test creation, coverage targets, and quality standards",
  "principles": [
    {
      "id": "coverage-completeness",
      "name": "Coverage Completeness",
      "description": "Tests must cover all critical paths, edge cases, and boundary conditions to ensure comprehensive quality assurance.",
      "priority": "critical",
      "category": "coverage",
      "mandatory": true,
      "tags": ["coverage", "completeness", "critical-paths"]
    },
    {
      "id": "test-isolation",
      "name": "Test Isolation",
      "description": "Each test must be independent and not rely on state from other tests. Tests should be executable in any order.",
      "priority": "high",
      "category": "design",
      "mandatory": true,
      "tags": ["isolation", "independence", "deterministic"]
    },
    {
      "id": "meaningful-assertions",
      "name": "Meaningful Assertions",
      "description": "Every test must contain meaningful assertions that verify expected behavior, not just exercise code paths.",
      "priority": "high",
      "category": "quality",
      "mandatory": true,
      "tags": ["assertions", "verification", "quality"]
    },
    {
      "id": "clear-naming",
      "name": "Clear Naming Convention",
      "description": "Test names must clearly describe what is being tested, the scenario, and the expected outcome.",
      "priority": "medium",
      "category": "maintainability",
      "tags": ["naming", "readability", "documentation"]
    },
    {
      "id": "edge-case-coverage",
      "name": "Edge Case Coverage",
      "description": "Tests must include boundary values, null/undefined inputs, empty collections, and error conditions.",
      "priority": "high",
      "category": "coverage",
      "tags": ["edge-cases", "boundaries", "error-handling"]
    },
    {
      "id": "performance-awareness",
      "name": "Performance Awareness",
      "description": "Tests should execute efficiently and not consume excessive resources or time.",
      "priority": "medium",
      "category": "efficiency",
      "tags": ["performance", "efficiency", "resources"]
    },
    {
      "id": "maintainability",
      "name": "Test Maintainability",
      "description": "Tests should be easy to understand, modify, and maintain as the codebase evolves.",
      "priority": "medium",
      "category": "maintainability",
      "tags": ["maintainability", "readability", "evolution"]
    }
  ],
  "rules": [
    {
      "id": "minimum-line-coverage",
      "name": "Minimum Line Coverage",
      "principleId": "coverage-completeness",
      "condition": {
        "field": "line_coverage",
        "operator": "less_than",
        "value": 80
      },
      "action": {
        "type": "fail",
        "message": "Line coverage is below 80%. Add more tests to improve coverage.",
        "stopProcessing": true
      },
      "severity": "error",
      "enabled": true,
      "description": "Enforces minimum line coverage threshold",
      "remediation": "Analyze uncovered lines and create tests targeting those code paths"
    },
    {
      "id": "minimum-branch-coverage",
      "name": "Minimum Branch Coverage",
      "principleId": "coverage-completeness",
      "condition": {
        "field": "branch_coverage",
        "operator": "less_than",
        "value": 70
      },
      "action": {
        "type": "fail",
        "message": "Branch coverage is below 70%. Add tests for conditional branches.",
        "stopProcessing": true
      },
      "severity": "error",
      "enabled": true,
      "description": "Enforces minimum branch coverage threshold",
      "remediation": "Identify uncovered branches and create tests for each condition"
    },
    {
      "id": "minimum-assertions",
      "name": "Minimum Assertions per Test",
      "principleId": "meaningful-assertions",
      "condition": {
        "field": "assertions_per_test",
        "operator": "less_than",
        "value": 1
      },
      "action": {
        "type": "fail",
        "message": "Tests must have at least one assertion. Tests without assertions provide no value.",
        "stopProcessing": true
      },
      "severity": "error",
      "enabled": true,
      "description": "Ensures every test has at least one assertion",
      "remediation": "Add meaningful assertions that verify expected behavior"
    },
    {
      "id": "assertion-density",
      "name": "Assertion Density",
      "principleId": "meaningful-assertions",
      "condition": {
        "field": "assertion_density",
        "operator": "less_than",
        "value": 2
      },
      "action": {
        "type": "warn",
        "message": "Low assertion density. Consider adding more assertions per test."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Monitors assertion density in tests"
    },
    {
      "id": "test-naming-convention",
      "name": "Test Naming Convention",
      "principleId": "clear-naming",
      "condition": {
        "field": "test_name_valid",
        "operator": "equals",
        "value": false
      },
      "action": {
        "type": "warn",
        "message": "Test names should follow naming conventions (should/test/it/describe/when/given)."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Checks test naming follows conventions"
    },
    {
      "id": "no-shared-state",
      "name": "No Shared State",
      "principleId": "test-isolation",
      "condition": {
        "field": "shared_state_detected",
        "operator": "equals",
        "value": true
      },
      "action": {
        "type": "fail",
        "message": "Shared state detected between tests. Each test must be independent.",
        "stopProcessing": false
      },
      "severity": "error",
      "enabled": true,
      "description": "Detects shared state that breaks test isolation",
      "remediation": "Use beforeEach/afterEach to reset state or isolate dependencies"
    },
    {
      "id": "test-execution-time",
      "name": "Test Execution Time Limit",
      "principleId": "performance-awareness",
      "condition": {
        "field": "avg_test_duration",
        "operator": "greater_than",
        "value": 1000,
        "unit": "ms"
      },
      "action": {
        "type": "warn",
        "message": "Average test duration exceeds 1 second. Consider optimizing slow tests."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Monitors test execution performance"
    },
    {
      "id": "edge-cases-present",
      "name": "Edge Cases Present",
      "principleId": "edge-case-coverage",
      "condition": {
        "field": "edge_case_count",
        "operator": "less_than",
        "value": 3
      },
      "action": {
        "type": "warn",
        "message": "Few edge cases detected. Consider testing boundaries, nulls, and error conditions."
      },
      "severity": "warning",
      "enabled": true,
      "description": "Ensures edge cases are included in test suite"
    }
  ],
  "metrics": [
    {
      "id": "line-coverage",
      "name": "Line Coverage",
      "description": "Percentage of code lines covered by tests",
      "unit": "percent",
      "aggregation": "avg",
      "dataType": "percentage",
      "higherIsBetter": true,
      "targetValue": 90,
      "warningThreshold": 80,
      "criticalThreshold": 70
    },
    {
      "id": "branch-coverage",
      "name": "Branch Coverage",
      "description": "Percentage of code branches covered by tests",
      "unit": "percent",
      "aggregation": "avg",
      "dataType": "percentage",
      "higherIsBetter": true,
      "targetValue": 85,
      "warningThreshold": 70,
      "criticalThreshold": 60
    },
    {
      "id": "function-coverage",
      "name": "Function Coverage",
      "description": "Percentage of functions covered by tests",
      "unit": "percent",
      "aggregation": "avg",
      "dataType": "percentage",
      "higherIsBetter": true,
      "targetValue": 95,
      "warningThreshold": 85,
      "criticalThreshold": 75
    },
    {
      "id": "test-count",
      "name": "Test Count",
      "description": "Total number of tests generated",
      "unit": "tests",
      "aggregation": "count",
      "dataType": "count",
      "higherIsBetter": true
    },
    {
      "id": "assertions-per-test",
      "name": "Assertions per Test",
      "description": "Average number of assertions per test",
      "unit": "assertions",
      "aggregation": "avg",
      "dataType": "ratio",
      "higherIsBetter": true,
      "targetValue": 3,
      "warningThreshold": 2,
      "criticalThreshold": 1
    },
    {
      "id": "assertion-density",
      "name": "Assertion Density",
      "description": "Ratio of assertions to lines of test code",
      "unit": "ratio",
      "aggregation": "avg",
      "dataType": "ratio",
      "higherIsBetter": true,
      "targetValue": 0.1,
      "warningThreshold": 0.05
    },
    {
      "id": "edge-case-count",
      "name": "Edge Case Count",
      "description": "Number of edge case tests included",
      "unit": "tests",
      "aggregation": "count",
      "dataType": "count",
      "higherIsBetter": true
    },
    {
      "id": "avg-test-duration",
      "name": "Average Test Duration",
      "description": "Average time to execute a single test",
      "unit": "ms",
      "aggregation": "avg",
      "dataType": "duration",
      "higherIsBetter": false,
      "targetValue": 100,
      "warningThreshold": 500,
      "criticalThreshold": 1000
    },
    {
      "id": "total-test-duration",
      "name": "Total Test Duration",
      "description": "Total time to execute all tests",
      "unit": "seconds",
      "aggregation": "sum",
      "dataType": "duration",
      "higherIsBetter": false
    },
    {
      "id": "mutation-score",
      "name": "Mutation Score",
      "description": "Percentage of mutations killed by tests",
      "unit": "percent",
      "aggregation": "avg",
      "dataType": "percentage",
      "higherIsBetter": true,
      "targetValue": 80,
      "warningThreshold": 60,
      "criticalThreshold": 40
    }
  ],
  "thresholds": [
    {
      "id": "line-coverage-gate",
      "metricId": "line-coverage",
      "name": "Line Coverage Gate",
      "mode": "percentage",
      "warning": 80,
      "critical": 70,
      "target": 90,
      "blocking": true
    },
    {
      "id": "branch-coverage-gate",
      "metricId": "branch-coverage",
      "name": "Branch Coverage Gate",
      "mode": "percentage",
      "warning": 70,
      "critical": 60,
      "target": 85,
      "blocking": true
    },
    {
      "id": "function-coverage-gate",
      "metricId": "function-coverage",
      "name": "Function Coverage Gate",
      "mode": "percentage",
      "warning": 85,
      "critical": 75,
      "target": 95,
      "blocking": false
    },
    {
      "id": "test-duration-gate",
      "metricId": "avg-test-duration",
      "name": "Test Performance Gate",
      "mode": "absolute",
      "warning": 500,
      "critical": 1000,
      "target": 100,
      "blocking": false
    },
    {
      "id": "mutation-score-gate",
      "metricId": "mutation-score",
      "name": "Mutation Score Gate",
      "mode": "percentage",
      "warning": 60,
      "critical": 40,
      "target": 80,
      "blocking": false
    }
  ],
  "metadata": {
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-11-19T00:00:00Z",
    "author": "Agentic QE Fleet",
    "applicableTo": ["test-generator", "qe-test-generator"],
    "inheritsFrom": "default",
    "status": "active",
    "changelog": [
      {
        "version": "1.0.0",
        "date": "2024-11-19T00:00:00Z",
        "description": "Initial release of test generation constitution",
        "author": "Constitution Schema Designer"
      }
    ]
  }
}
