# Agent Factory System\n\nThe Agent Factory System provides a comprehensive framework for dynamically creating and managing TypeScript agent instances from YAML definitions.\n\n## Features\n\n- **Dynamic Agent Creation**: Load agent definitions from YAML files and instantiate them as TypeScript objects\n- **YAML Schema Validation**: Validate agent definitions using Zod schemas\n- **Tool System**: Extensible tool executor with built-in testing tools\n- **Capability Matching**: Intelligent agent selection based on capabilities\n- **State Management**: Agent lifecycle and state management\n- **Event System**: Real-time event emission for agent activities\n- **Registry Management**: Centralized agent registry with indexing\n- **Caching**: Performance optimization through caching mechanisms\n\n## Core Components\n\n### 1. Agent Factory (`agent-factory.ts`)\n\nThe main factory class responsible for:\n- Loading YAML definitions\n- Creating agent instances\n- Managing agent lifecycle\n- Caching and performance optimization\n\n```typescript\nimport { createAgentFactory } from './agents/factory';\n\nconst factory = createAgentFactory('./agents');\nconst agent = await factory.createFromName('boundary-tester');\n```\n\n### 2. YAML Agent (`yaml-agent.ts`)\n\nGeneric agent implementation that can be instantiated from any YAML definition:\n- System prompt integration\n- Tool execution\n- State management\n- Event emission\n\n### 3. Tool Executor (`tool-executor.ts`)\n\nExecutes agent tools with built-in implementations for:\n- Boundary value analysis\n- Invalid payload generation\n- Fuzz testing\n- Error handling validation\n\n### 4. Agent Registry (`agent-registry.ts`)\n\nManages agent instances with:\n- Capability-based indexing\n- Search functionality\n- Health monitoring\n- Statistics collection\n\n### 5. Capability Matcher (`capability-matcher.ts`)\n\nIntelligent agent selection based on:\n- Exact capability matches\n- Fuzzy string matching\n- Weighted scoring algorithms\n- Team composition suggestions\n\n## YAML Agent Definition Format\n\n```yaml\nname: boundary-tester\nversion: \"1.0.0\"\ndescription: \"Specialized in boundary value analysis\"\ncategory: \"testing\"\n\ncapabilities:\n  - boundary_testing\n  - test_generation\n  - edge_case_analysis\n\ntools:\n  - name: boundary_value_analysis\n    description: \"Generate boundary test cases\"\n    parameters:\n      field_spec:\n        type: object\n        description: \"Field specification\"\n\nparameters:\n  max_test_cases:\n    type: integer\n    default: 10\n    description: \"Maximum number of test cases\"\n\nstates:\n  created:\n    description: \"Initial state\"\n    transitions:\n      - to: \"initialized\"\n        trigger: \"initialize\"\n\nhooks:\n  pre_task:\n    - validate_inputs\n    - prepare_environment\n  post_task:\n    - cleanup_resources\n    - log_results\n\nsystem_prompt: |\n  You are a boundary testing specialist focused on finding edge cases.\n```\n\n## Usage Examples\n\n### Quick Start\n\n```typescript\nimport { quickStartFactory } from './agents/factory';\n\n// Initialize factory and discover agents\nconst { factory, availableAgents, registry } = await quickStartFactory('./agents');\nconsole.log('Available agents:', availableAgents);\n\n// Create an agent\nconst agent = await factory.createFromName('boundary-tester');\n\n// Execute a task\nconst result = await agent.execute('Generate boundary test cases for age field (0-120)');\nconsole.log('Task result:', result);\n```\n\n### Advanced Usage\n\n```typescript\nimport { agentFactory, findBestAgentForTask, createAgentTeam } from './agents/factory';\n\n// Build factory with custom configuration\nconst factory = agentFactory()\n  .agentsDirectory('./agents')\n  .defaultModel('claude-3-opus')\n  .defaultTemperature(0.7)\n  .enableHooks(true)\n  .build();\n\n// Find best agent for a task\nconst { agent, score, reasoning } = await findBestAgentForTask(\n  factory,\n  'Perform security vulnerability assessment',\n  ['security_testing', 'vulnerability_assessment']\n);\n\n// Create a team of agents\nconst { agents, errors } = await createAgentTeam(factory, [\n  'boundary-tester',\n  'security-scanner',\n  'performance-analyzer'\n]);\n\n// Execute comprehensive testing workflow\nfor (const agent of agents) {\n  const result = await agent.execute('Analyze application for issues');\n  console.log(`${agent.name} results:`, result);\n}\n```\n\n### Capability Matching\n\n```typescript\nimport { CapabilityAnalyzer, DefaultCapabilityMatcher } from './agents/factory';\n\n// Analyze capability coverage\nconst coverage = CapabilityAnalyzer.analyzeCoverage(agents);\nconsole.log('Capability coverage:', coverage);\n\n// Suggest optimal team\nconst teamSuggestion = CapabilityAnalyzer.suggestTeam(\n  ['boundary_testing', 'security_testing', 'performance_testing'],\n  availableAgents,\n  3 // max team size\n);\nconsole.log('Suggested team:', teamSuggestion);\n```\n\n## Built-in Tools\n\nThe factory system includes several built-in tools for quality engineering:\n\n### Boundary Value Analysis\nGenerates test cases for boundary conditions:\n```typescript\nconst parameters = {\n  field_spec: {\n    name: 'age',\n    type: 'integer',\n    min: 18,\n    max: 120\n  }\n};\n```\n\n### Invalid Payload Generation\nCreates malformed data for negative testing:\n```typescript\nconst parameters = {\n  schema: { /* JSON schema */ },\n  mutation_types: ['type_mismatch', 'missing_required']\n};\n```\n\n### Fuzz Testing\nGenerates randomized test data:\n```typescript\nconst parameters = {\n  base_payload: { name: 'test', value: 42 },\n  fuzz_level: 'moderate' // light, moderate, aggressive\n};\n```\n\n### Error Handling Validation\nAssesses error response quality:\n```typescript\nconst parameters = {\n  error_response: {\n    status: 400,\n    message: 'Bad Request',\n    code: 'INVALID_INPUT'\n  },\n  expected_behavior: { status_code: 400 }\n};\n```\n\n## Testing\n\nThe factory system includes comprehensive tests:\n\n```bash\n# Run all factory tests\nnpm test -- src/agents/factory/__tests__/\n\n# Run specific test suite\nnpm test -- src/agents/factory/__tests__/agent-factory.test.ts\n```\n\n## Integration with Existing System\n\nThe factory system is designed to work alongside the existing agent registry system:\n\n```typescript\n// Use with existing agent spawner\nimport { agentRegistry } from '../index';\nimport { quickStartFactory } from './factory';\n\n// Initialize both systems\nconst existingRegistry = await agentRegistry.initialize();\nconst { factory } = await quickStartFactory('./agents');\n\n// Use factory for dynamic agent creation\nconst dynamicAgent = await factory.createFromName('custom-agent');\n\n// Use existing system for predefined agents\nconst existingAgent = existingRegistry.getAgent('predefined-agent');\n```\n\n## Performance Considerations\n\n- **Caching**: Agent definitions and available agents list are cached\n- **Lazy Loading**: Agents are only loaded when needed\n- **Connection Pooling**: Tool executors can be shared across agents\n- **Memory Management**: Proper cleanup and resource management\n- **Concurrent Operations**: Safe for parallel agent creation and execution\n\n## Error Handling\n\nThe system provides robust error handling:\n\n- **Validation Errors**: Clear messages for invalid YAML definitions\n- **Runtime Errors**: Graceful handling of agent execution failures\n- **Resource Errors**: Proper cleanup on failures\n- **Capability Errors**: Helpful messages when capabilities don't match\n\n## Extensibility\n\nThe factory system is designed for extensibility:\n\n- **Custom Tools**: Register new tools with the tool executor\n- **Custom Matchers**: Implement new capability matching algorithms\n- **Custom States**: Define custom agent state machines\n- **Custom Events**: Add new event types for monitoring\n\nThis factory system provides a powerful foundation for creating and managing AI agents dynamically based on YAML configurations, making it easy to add new agent types without requiring code changes.\n"